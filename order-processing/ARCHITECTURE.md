# Order Processing - Visual Architecture

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TEMPORAL SERVER                          â”‚
â”‚                    (docker-compose running)                      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   Frontend   â”‚  â”‚   History    â”‚  â”‚   Matching   â”‚          â”‚
â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                PostgreSQL Database                      â”‚     â”‚
â”‚  â”‚              (Workflow State & History)                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   order-task-queue      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†•
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            WORKER                                â”‚
â”‚                    (go run worker/main.go)                       â”‚
â”‚                                                                   â”‚
â”‚  Registered Workflows:                                           â”‚
â”‚  â”œâ”€â”€ OrderWorkflow                                              â”‚
â”‚  â””â”€â”€ GreetUser                                                  â”‚
â”‚                                                                   â”‚
â”‚  Registered Activities (15):                                     â”‚
â”‚  â”œâ”€â”€ Inventory: Reserve, Release, FetchSnapshot                 â”‚
â”‚  â”œâ”€â”€ Payment: Process, Refund                                   â”‚
â”‚  â”œâ”€â”€ Customer: FetchProfile                                     â”‚
â”‚  â”œâ”€â”€ Recommendations: Fetch                                     â”‚
â”‚  â”œâ”€â”€ Order: UpdateStatus                                        â”‚
â”‚  â”œâ”€â”€ Notifications: Confirmation, Cancellation                  â”‚
â”‚  â””â”€â”€ Greet: GetDetails, GetPrefs, Send, Log                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â†‘
                                  â”‚ Starts Workflows
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           STARTER                                â”‚
â”‚                   (go run starter/main.go)                       â”‚
â”‚                                                                   â”‚
â”‚  Creates Client â†’ Starts Workflow â†’ Sends Signals               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ OrderWorkflow Execution Flow

```
                    START: OrderWorkflow
                            â”‚
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         1. ENRICHMENT (Parallel)              â”‚
    â”‚                                                â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚   â”‚ FetchInventory  â”‚  â”‚ FetchCustomer    â”‚  â”‚
    â”‚   â”‚   Snapshot      â”‚  â”‚   Profile        â”‚  â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚            â”‚                     â”‚             â”‚
    â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
    â”‚                       â”‚                        â”‚
    â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
    â”‚            â”‚ FetchRecommend-  â”‚                â”‚
    â”‚            â”‚    ations        â”‚                â”‚
    â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         2. RESERVE STOCK                       â”‚
    â”‚                                                â”‚
    â”‚   Activity: ReserveStock(orderID, items)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    3. AWAIT APPROVAL (Signal Loop)            â”‚
    â”‚                                                â”‚
    â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚   â”‚  Wait for Signals (Selector):       â”‚    â”‚
    â”‚   â”‚                                      â”‚    â”‚
    â”‚   â”‚  â€¢ approve-payment â†’ Continue       â”‚    â”‚
    â”‚   â”‚  â€¢ cancel-order â†’ Compensate+Exit   â”‚    â”‚
    â”‚   â”‚  â€¢ add-line-item â†’ Update Items     â”‚    â”‚
    â”‚   â”‚  â€¢ timer(15min) â†’ Auto-Cancel       â”‚    â”‚
    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                   â”‚
              Approved            Cancelled
                  â”‚                   â”‚
                  â†“                   â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  4. PROCESS         â”‚   â”‚  COMPENSATION:   â”‚
    â”‚     PAYMENT         â”‚   â”‚                  â”‚
    â”‚                     â”‚   â”‚  â€¢ ReleaseStock  â”‚
    â”‚  Activity:          â”‚   â”‚  â€¢ SendCancel    â”‚
    â”‚  ProcessPayment     â”‚   â”‚    Email         â”‚
    â”‚                     â”‚   â”‚                  â”‚
    â”‚  (Retries on fail)  â”‚   â”‚  â†’ EXIT          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  5. UPDATE          â”‚
    â”‚     STATUS          â”‚
    â”‚                     â”‚
    â”‚  Activity:          â”‚
    â”‚  UpdateOrderStatus  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  6. SEND            â”‚
    â”‚     CONFIRMATION    â”‚
    â”‚                     â”‚
    â”‚  Activity:          â”‚
    â”‚  SendConfirmation   â”‚
    â”‚  (Best-effort)      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â†“
            COMPLETED âœ…
```

---

## ğŸ”§ Component Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       types/                                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  types.go    â”‚           â”‚  errors.go    â”‚             â”‚
â”‚  â”‚              â”‚           â”‚               â”‚             â”‚
â”‚  â”‚  â€¢ LineItem  â”‚           â”‚  â€¢ Permanent  â”‚             â”‚
â”‚  â”‚  â€¢ Status    â”‚           â”‚  â€¢ Validation â”‚             â”‚
â”‚  â”‚  â€¢ Signals   â”‚           â”‚  â€¢ Transient  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†‘                â†‘
                         â”‚                â”‚
                Used by  â”‚                â”‚  Used by
                         â”‚                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   workflows/      â”‚                          â”‚   activities/     â”‚
â”‚                   â”‚                          â”‚                   â”‚
â”‚  order_workflow   â”‚â†â”€â”€â”€â”€â”€â”€ Executes â”€â”€â”€â”€â”€â”€â”€â”€â”‚  order_activities â”‚
â”‚  greet_workflow   â”‚                          â”‚  greet_activities â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†‘                                              â†‘
        â”‚                                              â”‚
        â”‚ Registers                          Registers â”‚
        â”‚                                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   worker/    â”‚
                    â”‚   main.go    â”‚
                    â”‚              â”‚
                    â”‚  â€¢ Creates   â”‚
                    â”‚    Worker    â”‚
                    â”‚  â€¢ Registers â”‚
                    â”‚    All       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†‘
                           â”‚ Started by
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   starter/   â”‚
                    â”‚   main.go    â”‚
                    â”‚              â”‚
                    â”‚  â€¢ Starts    â”‚
                    â”‚    Workflows â”‚
                    â”‚  â€¢ Sends     â”‚
                    â”‚    Signals   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ Code Organization

```
order-processing/
â”‚
â”œâ”€â”€ types/                      # Shared Types
â”‚   â”œâ”€â”€ types.go               # Domain models
â”‚   â”‚   â”œâ”€â”€ LineItem
â”‚   â”‚   â”œâ”€â”€ OrderWorkflowStatus
â”‚   â”‚   â”œâ”€â”€ OrderEnrichment
â”‚   â”‚   â”œâ”€â”€ PaymentApproval (signal)
â”‚   â”‚   â”œâ”€â”€ CancelRequest (signal)
â”‚   â”‚   â”œâ”€â”€ UserDetails
â”‚   â”‚   â””â”€â”€ UserPreferences
â”‚   â”‚
â”‚   â””â”€â”€ errors.go              # Custom errors
â”‚       â”œâ”€â”€ PermanentError
â”‚       â”œâ”€â”€ ValidationError
â”‚       â””â”€â”€ PaymentTransientError
â”‚
â”œâ”€â”€ activities/                # Side Effects
â”‚   â”œâ”€â”€ order_activities.go
â”‚   â”‚   â”œâ”€â”€ InventoryActivities
â”‚   â”‚   â”‚   â”œâ”€â”€ ReserveStock
â”‚   â”‚   â”‚   â”œâ”€â”€ ReleaseStock
â”‚   â”‚   â”‚   â””â”€â”€ FetchInventorySnapshot
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ PaymentActivities
â”‚   â”‚   â”‚   â”œâ”€â”€ ProcessPayment
â”‚   â”‚   â”‚   â””â”€â”€ RefundPayment
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ CustomerActivities
â”‚   â”‚   â”‚   â””â”€â”€ FetchCustomerProfile
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ RecommendationActivities
â”‚   â”‚   â”‚   â””â”€â”€ FetchRecommendations
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ OrderActivities
â”‚   â”‚   â”‚   â””â”€â”€ UpdateOrderStatus
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ NotificationActivities
â”‚   â”‚       â”œâ”€â”€ SendOrderConfirmation
â”‚   â”‚       â””â”€â”€ SendCancellationEmail
â”‚   â”‚
â”‚   â””â”€â”€ greet_activities.go
â”‚       â””â”€â”€ GreetActivities
â”‚           â”œâ”€â”€ GetUserDetails
â”‚           â”œâ”€â”€ GetUserPreferences
â”‚           â”œâ”€â”€ SendGreeting
â”‚           â””â”€â”€ LogGreeting
â”‚
â”œâ”€â”€ workflows/                 # Orchestration
â”‚   â”œâ”€â”€ order_workflow.go
â”‚   â”‚   â””â”€â”€ OrderWorkflow
â”‚   â”‚       â”œâ”€â”€ Versioning (GetVersion)
â”‚   â”‚       â”œâ”€â”€ Enrichment (parallel)
â”‚   â”‚       â”œâ”€â”€ Signal handlers (3)
â”‚   â”‚       â”œâ”€â”€ Query handlers (2)
â”‚   â”‚       â”œâ”€â”€ Retry policies
â”‚   â”‚       â””â”€â”€ Compensation logic
â”‚   â”‚
â”‚   â””â”€â”€ greet_workflow.go
â”‚       â””â”€â”€ GreetUser
â”‚           â”œâ”€â”€ Parallel activities
â”‚           â””â”€â”€ Time-based logic
â”‚
â”œâ”€â”€ worker/                    # Execution
â”‚   â””â”€â”€ main.go
â”‚       â”œâ”€â”€ Client setup
â”‚       â”œâ”€â”€ Worker creation
â”‚       â”œâ”€â”€ Workflow registration
â”‚       â””â”€â”€ Activity registration
â”‚
â””â”€â”€ starter/                   # Client
    â””â”€â”€ main.go
        â”œâ”€â”€ Start OrderWorkflow
        â”œâ”€â”€ Start GreetUser
        â”œâ”€â”€ Send signals
        â””â”€â”€ Query status
```

---

## ğŸ¯ Data Flow Example

### Successful Order Flow

```
1. Starter sends: OrderWorkflow("ORDER-123", [items])
                         â†“
2. Worker picks up: WorkflowTask
                         â†“
3. Workflow schedules: FetchInventorySnapshot
                         â†“
4. Worker executes: Activity returns {available: true}
                         â†“
5. Workflow schedules: ReserveStock
                         â†“
6. Worker executes: Activity reserves inventory
                         â†“
7. Workflow waits: Selector for signals
                         â†“
8. Starter sends: Signal("approve-payment", {ApprovedBy: "admin"})
                         â†“
9. Workflow receives: Signal, continues to payment
                         â†“
10. Workflow schedules: ProcessPayment
                         â†“
11. Worker executes: Activity charges payment
                         â†“
12. Workflow schedules: UpdateOrderStatus
                         â†“
13. Worker executes: Activity updates DB
                         â†“
14. Workflow schedules: SendOrderConfirmation
                         â†“
15. Worker executes: Activity sends email
                         â†“
16. Workflow completes: Returns "Order ORDER-123 completed"
                         â†“
17. Starter receives: Result âœ…
```

---

## ğŸ”„ Error Handling Flow

### Payment Failure with Retry

```
1. ProcessPayment executes
        â†“
2. Returns: PaymentTransientError("gateway timeout")
        â†“
3. Temporal checks: NonRetryableErrorTypes
        â†“
4. Not in list: RETRY
        â†“
5. Wait: InitialInterval (1s)
        â†“
6. Retry attempt 2
        â†“
7. Returns: PaymentTransientError again
        â†“
8. Wait: BackoffCoefficient Ã— previous (2s)
        â†“
9. Retry attempt 3
        â†“
10. Returns: SUCCESS âœ…
        â†“
11. Continue to next step
```

### Permanent Error Flow

```
1. ProcessPayment executes
        â†“
2. Returns: PermanentError("card declined")
        â†“
3. Temporal checks: NonRetryableErrorTypes
        â†“
4. Found in list: NO RETRY
        â†“
5. Workflow catches error
        â†“
6. Compensation: ReleaseStock
        â†“
7. Workflow fails: Returns error âŒ
```

---

## ğŸ§© Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External Systems                        â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Database   â”‚  â”‚  Email Svc   â”‚  â”‚ Payment  â”‚ â”‚
â”‚  â”‚  (Orders)    â”‚  â”‚  (SendGrid)  â”‚  â”‚ Gateway  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘                  â†‘                â†‘
         â”‚                  â”‚                â”‚
     Called by          Called by        Called by
         â”‚                  â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Activities                         â”‚
â”‚  (Side effects isolated in activities)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ Scheduled by
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Workflows                          â”‚
â”‚  (Pure orchestration, no side effects)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ Executed by
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Worker                            â”‚
â”‚  (Polls for tasks, executes code)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
         â”‚ Connected to
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Temporal Server                         â”‚
â”‚  (Orchestration engine, state management)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š State Transitions

```
OrderWorkflowStatus.Stage:

  start
    â†“
  enrichment
    â†“
  reserve
    â†“
  awaiting-approval  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                           â”‚
    â”œâ”€â†’ cancelled â”€â”€â†’ [END]    â”‚
    â”‚                           â”‚
    â†“                           â”‚
  payment                       â”‚
    â†“                           â”‚
  status-update                 â”‚
    â†“                           â”‚
  notify                        â”‚
    â†“                           â”‚
  completed â”€â”€â†’ [END]           â”‚
                                â”‚
  (signals can loop back) â”€â”€â”€â”€â”€â”€â”˜
```

---

This visual guide helps understand:
- âœ… System architecture
- âœ… Component relationships
- âœ… Data flow
- âœ… Error handling
- âœ… State transitions

Refer to this when:
- ğŸ” Understanding the big picture
- ğŸ› Debugging issues
- ğŸ”¨ Extending functionality
- ğŸ“š Teaching others

